{% extends 'base.html'%}
{% load static %}

{% block content %}
<body style="background-image: url({% static 'images/background1.2.jpg' %}); background-size: cover;background-position: center center;background-attachment: fixed;">
 <script>
  
  $.ajax('http://ip-api.com/json')
  .then(
      function success(response) {
          $("#zipsearch").val(response.zip);
          getAdress(response.lat, response.lon)
},

      function fail(data, status) {
          console.log('Request failed.  Returned status of',
                      status);
      }
  );
  </script>
    {% if alert_flag %}
    <script>alert("{{response}}")</script>  
    {% endif %}  
    <div class = "location-content">
        <div style="background-color:white; color: black; margin: 3%; border-radius:1rem;"><!--border-radius:10px-->
            <br>
            
            <!-- Search Locations: -->
            <!-- Current implementation is by zipcode: -->
            <div id="search-box" style = "background-color: #333;padding: 30px;margin-left: 5%;margin-right: 5%; margin-top: 1%;border-radius:10px;">
                <h1 class="text-center" style="font-family: Bearskin; flex-grow:1; color:white;">Which beary bite-tastic partners are near you?</h1>
                <form class="form-inline justify-content-center" method="POST">
                    {% csrf_token %}
                    <i class="fa fa-search fa-3x py-2 p-1" style="color:white;"></i>
                    <input class="form-control form-control-lg ml-3 w-40" type="text" id="zipsearch" name ="search" placeholder="Zipcode" aria-label="Search" value="{{searchZip}}">
                    <input class="form-control form-control-lg ml-3 w-40" type="text"  name ="searchName" placeholder="Restaurant Name" aria-label="SearchName" value="{{searchName}}">
                    <input style="margin-left:10px" type="submit" name="submit" value="submit" class="btn btn-primary btn-lg">
                </form>
            </div>
            
            <br>
            
            <h1 class="text-center" style="font-family: Bearskin; flex-grow:1;"> Locations: </h1>
            
            
            
            <!-- To Do: show restaurant upon clicking it. -->
            <div class = "card-deck" style = "margin:2%; padding-bottom:5rem;"> <!--padding-bottom:100px-->
                <!--Restaurant List-->
              
                <!-- To Do: Only show restaurants that are Open during current hours -->
                {% for restaurant in restaurants %}
                        <br>
                        <div class="col-sm-6 card text-decoration-none" style="width:10rem;width:30rem; height: 35rem; margin: auto; text-align: center; background-color:#333; border-radius:1rem; opacity: 0.9; padding:1rem;border-color:white; border-width:0.5rem;">
                        <!--style=" max-width: 300px;border-radius:10px; padding:25px"-->
                            <a data-toggle="modal" id='menurestaurant' data-target="#restaurantPop" onclick='UpdatePKFunction({{ restaurant.RestaurantID }})' >
                                <!-- image of restaurant -->
                                <!--style="height:200px"-->
                                <div class="card-header" style="height:12rem;width:12rem; overflow: hidden;">
                                    <img src="{{restaurant.LogoUrl}}" style="width:20rem;"> <!--width:350px-->
                                </div> 
                                
                                <div class="card-body">
                                    <!-- restaurant name -->
                                    <h2 style="color:#0094FF;">{{restaurant.RestaurantName}}</h2>
                                    <!--style:"font-size:18px"-->
                                    <p class="title" style = "color:white; font-weight:bold; font-size: medium;font-family: sans seriff;">{{restaurant.address}}</p>
                                    
                                    <!-- availability -->
                                    <!--style:"font-size:18px"-->
                                    <p class="title" style = "color:white; font-weight:bold; font-size: medium;font-family: sans seriff;">Available for Delivery!</p>
                                </div>
                                <!-- restaurant item type -->
                                
                                <!-- button for ordering from -->
                                <!-- TO DO: Check if user is logged in first-> if not ask if they want to log in. -->
                                <!--style:"font-size:30px"
                                <div class="card-footer"><input onclick= "to_order()"  type="submit" name="submit" value="Order Now!" class="btn btn-primary btn-lock btn-block"></button></div>-->

                                <!-- Supposed popup box that shows up when you click on resturant order button-->
                            </a>
                            <div class="card-footer" style="align-content: bottom;">
                               
                                <a data-toggle="modal" class="nav-link btn btn-primary" data-target="#restaurantPop" onclick='UpdatePKFunction({{ restaurant.RestaurantID }})'; >Order Now!</a>
                                

                            </div>
                        </div>
                {% endfor %}
            </div>

            <div class="modal fade" role="dialog" tabindex="-1" id="restaurantPop">
                <div class =  "modal-dialog modal-lg" role="document" >
                    
                </div>    
            </div>
        </div>
            
    </div>
    <script>
        var orgurl = window.location.protocol + "/" + window.location.host +"/locations"
        window.history.pushState({path:orgurl},'',"/locations/");
        
        function UpdatePKFunction(pk) {
            pk = pk
            
            $.ajax({ 
                url: '/searchRestaurant',
                data: { 
                    'pk': pk
                },
                success: function(pk) { 
                
                $('#restaurantPop').html(pk);
                
                }
            });
        };
        
    
    </script>
</body>                
{% endblock %}